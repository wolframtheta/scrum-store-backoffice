<div class="groups-list-container">
  <!-- Header -->
  <div class="page-header">
    <div>
      <h1 class="page-title">{{ 'admin.groups.title' | translate }}</h1>
      <p class="page-subtitle">{{ 'admin.groups.subtitle' | translate }}</p>
    </div>
    <p-button
      icon="pi pi-plus"
      [label]="'admin.groups.actions.create' | translate"
      (click)="openCreateDialog()"
    />
  </div>

  <!-- Filters -->
  <div class="filters-section">
    <span class="p-input-icon-left search-input">
      <i class="pi pi-search"></i>
      <input
        type="text"
        pInputText
        [placeholder]="'admin.groups.filters.searchPlaceholder' | translate"
        [(ngModel)]="searchTerm"
        (input)="onSearch()"
      />
    </span>

    <p-autocomplete
      [suggestions]="statusOptions"
      [(ngModel)]="selectedStatus"
      optionLabel="label"
      [placeholder]="'admin.groups.filters.status' | translate"
      (onChange)="onStatusChange()"
      styleClass="status-dropdown"
    >
      <ng-template let-option pTemplate="selectedItem">
        {{ option.label | translate }}
      </ng-template>
      <ng-template let-option pTemplate="item">
        {{ option.label | translate }}
      </ng-template>
    </p-autocomplete>
  </div>

  <!-- Table -->
  <p-table
    [value]="adminGroupsService.groups()"
    [loading]="adminGroupsService.isLoading()"
    [paginator]="true"
    [rows]="10"
    [totalRecords]="adminGroupsService.totalGroups()"
    [lazy]="true"
    (onLazyLoad)="onPageChange($event)"
    [rowsPerPageOptions]="[10, 20, 50]"
    styleClass="admin-table"
    responsiveLayout="scroll"
  >
    <ng-template #header>
      <tr>
        <th>{{ 'admin.groups.table.name' | translate }}</th>
        <th>{{ 'admin.groups.table.email' | translate }}</th>
        <th>{{ 'admin.groups.table.city' | translate }}</th>
        <th>{{ 'admin.groups.table.created' | translate }}</th>
        <th class="text-center">{{ 'admin.groups.table.status' | translate }}</th>
        <th class="text-center">{{ 'common.actions' | translate }}</th>
      </tr>
    </ng-template>
    <ng-template #body let-group>
      <tr>
        <td>
          <div class="group-name-cell">
            @if (group.image) {
              <img [src]="group.image" [alt]="group.name" class="group-avatar" />
            } @else {
              <div class="group-avatar-placeholder">
                {{ group.name.charAt(0).toUpperCase() }}
              </div>
            }
            <span class="group-name">{{ group.name }}</span>
          </div>
        </td>
        <td>{{ group.email }}</td>
        <td>{{ group.city }}</td>
        <td>{{ group.createdAt | date: 'dd/MM/yyyy' }}</td>
        <td class="text-center">
          <p-tag
            [value]="getStatusLabel(group.isActive) | translate"
            [severity]="getStatusSeverity(group.isActive)"
          />
        </td>
        <td class="text-center">
          <div class="action-buttons">
            <p-button
              icon="pi pi-eye"
              [text]="true"
              [rounded]="true"
              severity="secondary"
              size="small"
              [pTooltip]="'common.view' | translate"
              tooltipPosition="top"
              (click)="viewGroupDetail(group)"
            />
            <p-button
              [icon]="group.isActive ? 'pi pi-ban' : 'pi pi-check'"
              [text]="true"
              [rounded]="true"
              [severity]="group.isActive ? 'warn' : 'success'"
              size="small"
              [pTooltip]="(group.isActive ? 'admin.groups.actions.deactivate' : 'admin.groups.actions.activate') | translate"
              tooltipPosition="top"
              (click)="toggleGroupStatus(group)"
            />
            <p-button
              icon="pi pi-trash"
              [text]="true"
              [rounded]="true"
              severity="danger"
              size="small"
              [pTooltip]="'common.delete' | translate"
              tooltipPosition="top"
              (click)="deleteGroup(group)"
            />
          </div>
        </td>
      </tr>
    </ng-template>
    <ng-template #emptymessage>
      <tr>
        <td colspan="6" class="empty-message">
          <i class="pi pi-inbox"></i>
          <p>{{ 'admin.groups.table.empty' | translate }}</p>
        </td>
      </tr>
    </ng-template>
  </p-table>

  <!-- Create Group Dialog -->
  @if (showCreateDialog()) {
    <app-create-group-dialog
      [(visible)]="showCreateDialog"
      (groupCreated)="onGroupCreated($event)"
    />
  }
</div>

<p-toast />
<p-confirmDialog />

